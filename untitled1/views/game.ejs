<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>

    <!-- Ensure that everything scales appropriately on a mobile device -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <!-- Let's borrow a cool looking Font from Google -->

</head>

<body>
<div id="gameArea">
    <!-- This is where the templates defined below will be used -->
    <canvas id="myCanvas" width="1000" height="1000" style="border:1px solid #000000;">
    </canvas>


</div>
<button type='button' id = "button1">
    Create a new  game
</button>
<button type='button' id = "button2">
    Join an existing game
</button>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script src="https://hammerjs.github.io/dist/hammer.js"></script>

<p>

    <input type="text" name="name" id="txt_name" value = <%= user.local.email%>>

    <p>


<script>

    var socket = io();
    var name_element = document.getElementById('txt_name').value;
    var e1 = document.getElementById("myCanvas");
    var canvas = e1.getContext("2d");

    canvas.font = '30px Arial';
    socket.on('onconnected', function(data){
        console.log("Player connected "+data.id);

    });

    socket.on('players_present',function(data){
        console.log(data);
    });
    socket.on('new player connected',function(data)
    {
        console.log(data);
    });
    var xposition = Math.random();
    var yposition =Math.random();
    socket.on('message',function(data){
        console.log(data);
    });
    socket.emit('send_position',{x:xposition,y:yposition});
    socket.on('update',function(data){
        console.log("Update data: "+data.x);
        console.log("Update data: "+data.y);
        console.log("Update data: "+data.id);


    });
    socket.on('updatePlayer',function(data){
        console.log("Update Player :"+data);
    });

var scores = Math.round(Math.random()*100 + 1);



    socket.emit('update_score',{scores:scores,email:name_element});
    $('#button1').click(function(){

        socket.emit('hostCreateNewGame',{message:'23'},function() {



                    console.log("Success");
                }
        );
        socket.on('newGameCreated', function(data){
            console.log("Game id is : "+data.gameId+"Your socket id is  "+data.mySocketId);

        });
        socket.on('updateGame', function(data){
            console.log(data);

        });



    });


    $('#button2').click(function(){
        var response = {gameId :$('#text').val()};
      var text=  JSON.stringify(response);

        socket.emit('sendMessage',response,function(){

        });

    });
    socket.on('joinPlayer',function(data){
        console.log(data);

    });
    socket.on('playerleft',function(data){
        console.log(data);

    });

    socket.on('beginNewGame',function(data){
        console.log(data);
    });


    socket.on('newPosition',function(data){

        canvas.clearRect(0,0,500,500);

        obj = {x:50,y:50,w:70,h:70};
        for(var i = 0;i < data.length;i++) {
            canvas.fillText(data[i].number, data[i].x, data[i].y);
           //onsole.log(data[i].id);

        }


    });
        document.onkeydown - function(event){
            if (event.keyCode==68)
                socket.emit('keyPress',{inputId:'right',state:true});
            else if(event.keyCode === 83)   //s
                    socket.emit('keyPress',{inputId:'down',state:true});
                else if(event.keyCode === 65) //a
                    socket.emit('keyPress',{inputId:'left',state:true});

            else if(event.keyCode === 87) // w
                socket.emit('keyPress',{inputId:'up',state:true});

        }
        document.onkeyup = function(event){
            if(event.keyCode === 68)    //d
                socket.emit('keyPress',{inputId:'right',state:false});
            else if(event.keyCode === 83)   //s
                socket.emit('keyPress',{inputId:'down',state:false});
            else if(event.keyCode === 65) //a
                socket.emit('keyPress',{inputId:'left',state:false});
            else if(event.keyCode === 87) // w
                socket.emit('keyPress',{inputId:'up',state:false});
        }



</script>
<div id="gameArea">
    <!-- This is where the templates defined below will be used -->
    <textarea id="text"></textarea>
</div>
</body>
</html>








</body>
</html>
