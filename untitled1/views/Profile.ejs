<!doctype html>
<html>
<head>
    <title>Node Authentication</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <style>
        body        { padding-top:80px; word-wrap:break-word; }
    </style>
</head>
<body  ng-app = "myApp" ng-controller="profileController">
<div class="container">

    <div class="page-header text-center">
        <h1><span class="fa fa-anchor"></span> Profile Page</h1>
        <a href="/logout" class="btn btn-default btn-sm">Logout</a>
    </div>

    <div class="row">

        <!-- LOCAL INFORMATION -->
        <div class="col-sm-6">
            <div class="well">
                <h3><span class="fa fa-user"></span> Local</h3>

                <p>
                    <strong>id</strong>: <%= user._id %><br>
                    <strong>email</strong>: <%= user.local.email %><br>
                    <strong>password</strong>: <%= user.local.password %><br>
                    <strong>admin</strong>: <%= user.local.admin %><br>



                </p>

            </div>
        </div>

        <a href="/chat" class="btn btn-default btn-sm">Chat</a>
        <a href="/game" class="btn btn-default btn-sm">Play Game</a>
        <a href="/search" class="btn btn-default btn-sm">Search other users</a>
        <button ng-click="editmyInfo()" class="btn btn-default">Edit my info</button>
        <modal title="Update my info" visible="showModal" ng-submit="modifyInfo()">
            <form role="form">

                <div class="form-group">
                    <label for="email">Email address</label>
                    <input type="email" class="form-control" id="local.email" ng-model = "local.email" placeholder="{{email}}"/>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" ng-model = "local.password" placeholder="{{password}}" />
                </div>



                <button type="submit" class="btn btn-default">Submit</button>
            </form>
        </modal>

    </div>

</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" ></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular-route.min.js"></script>
<script>
    var app = angular.module('myApp', []);
    console.log('Controller is ready!');

    app.controller('profileController',['$scope','$http',function($scope,$http){
        $scope.showModal = false;
        $scope.local = {};
        $scope.editmyInfo  = function(){
            $scope.showModal = !$scope.showModal;
            $http({
                method: 'GET',
                url: '/modifyprofile'
            }).then(function successCallback(response) {

                var myEmail = response.data.user.local.email;
                var myPassword =response.data.user.local.password;
              $scope.email = myEmail;
                $scope.password = myPassword;

            }, function errorCallback(response) {


            });




            $scope.modifyInfo = function(){

                $http({
                    method: 'PUT',
                    url: '/modifyprofile',
                    data: $scope.local

                }).then(function successCallback(response) {

                    $scope.showModal = !$scope.showModal;
                    alert(response.data);


                }, function errorCallback(response) {


                });

            }




        }


    }]);

    app.directive('modal', function () {
        return {
            template: '<div class="modal fade">' +
            '<div class="modal-dialog">' +
            '<div class="modal-content">' +
            '<div class="modal-header">' +
            '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>' +
            '<h4 class="modal-title">{{ title }}</h4>' +
            '</div>' +
            '<div class="modal-body" ng-transclude></div>' +
            '</div>' +
            '</div>' +
            '</div>',
            restrict: 'E',
            transclude: true,
            replace:true,
            scope:true,
            link: function postLink(scope, element, attrs) {
                scope.title = attrs.title;

                scope.$watch(attrs.visible, function(value){
                    if(value == true)
                        $(element).modal('show');
                    else
                        $(element).modal('hide');
                });

                $(element).on('shown.bs.modal', function(){
                    scope.$apply(function(){
                        scope.$parent[attrs.visible] = true;
                    });
                });

                $(element).on('hidden.bs.modal', function(){
                    scope.$apply(function(){
                        scope.$parent[attrs.visible] = false;
                    });
                });
            }
        };
    });

</script>

</body>
</html>